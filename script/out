#! /usr/bin/env node
const webhook = require("webhook-discord");
const stdin = require("get-stdin");
async function getStdinAsJson() {
  var result;
  console.log(stdin);
  try {
    result = JSON.parse(await stdin());
  } catch (err) {
    console.error("Error thrown during parsing stdin!");
    throw err;
  }
  return result;
}

function getColor(value) {
  switch (String(value).toLowerCase()) {
    case "success":
      return "#1A4314";
    case "failed":
    case "errored":
    case "aborted":
      return "#800000";
    default:
      return "#FFFFFF";
  }
}

async function out() {
  try {
    var conf = await getStdinAsJson();
    const Hook = new webhook.Webhook(conf.source.webhook);
    const msg = new webhook.MessageBuilder()
      .setName("WeeboCI")
      .setTime(Date.now())
      .setColor(getColor(conf.status))
      .setTitle("test")
      .setText("This is my webhook!");
    Hook.send(msg);
  } catch (e) {
    console.log(e);
  }
  console.log(conf);
}

out();
